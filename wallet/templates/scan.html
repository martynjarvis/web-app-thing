{% extends "base.html" %}

{% block extra_head %}
<script type="text/javascript">
    $(document).ready(function() {
      $('#scan-total').text(type_ids.length);
    });
    
    var type_ids = [{% for row in data%}{{row[0]}}{% if not loop.last %},{%endif%}{% endfor %}];
    index = 0;
    is_scanning = false;
    delay = 3000;
    
    function start_stop() {
      if (is_scanning) {
        clearInterval(t);
        is_scanning = false;
        $('#scan-button').text('Paused, click to continue');
      }
      else {
        timer_callback();
        t = setInterval("timer_callback()", delay);
        is_scanning = true;
        $('#scan-button').text('Scanning, click to pause');
      }
    }
    
    function timer_callback() {
      if (index >= type_ids.length) {
        index = 0;
        is_scanning = false;
        clearInterval(t);
        $('#scan-button').text('Scan complete, click to restart');
      }
      else {
        CCPEVE.showMarketDetails(type_ids[index]);
        index++;
        $('#scan-done').text(index);
      }
    }
    
    function change_delay(amount) {
      delay += amount;
      if (delay < 3000) {
          delay = 3000;
      }
      if (is_scanning) {
          clearInterval(t);
          t = setInterval("timer_callback()", delay);
      }
      $('#interval').text(delay);
    }
  </script>

{% endblock %}


{% block content %}
    <div class="row-fluid">
        <div class="span4">
            <div class="page-header">
                <h1>Scan Market <small> Blatently stolen from goons </small></h1>
            </div>
        </div><!--/span--> 
    </div><!--/row-->  

    <div class="row-fluid">
        <div class="span12">

            <button class="btn btn-primary" id="scan-button" onclick="start_stop();">Scan market</button>
            <button class="btn btn-info btn-small" onclick="change_delay(-500);">-</button>
            <span id="interval">3000</span>ms
            <button class="btn btn-info btn-small" onclick="change_delay(500);">+</button> 
            : Scanned <strong id="scan-done">0</strong> of <strong id="scan-total"></strong>
        </div><!--/span-->   
    </div><!--/row-->    
    
      
  
{% endblock %}
